<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Oishii Wiesbaden - Japanisch essen, entdecken, erleben.</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&family=Pacifico&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
<div class="container-xxl bg-white p-0">
    <!-- Spinner Start -->

    <!-- Spinner End -->


    <!-- Navbar & Hero Start -->
    <div class="container-xxl position-relative p-0">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4 px-lg-5 py-3 py-lg-0">
            <a href="" class="navbar-brand p-0">
                <h1 class="text-primary m-0"><i class="fa fa-utensils me-3"></i>Restoran</h1>

            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="fa fa-bars"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto py-0 pe-4">

                </div>
                <a href="index.html" class="btn btn-primary py-2 px-4 ">Zur Startseite</a>
            </div>
        </nav>

        <div class="container-xxl py-5 bg-dark hero-header mb-5">
            <div class="container text-center my-5 pt-5 pb-4">
                <h1 class="display-3 text-white mb-3 animated slideInDown">Reservierung ändern/löschen</h1>
            </div>
        </div>
    </div>
    <!-- Navbar & Hero End -->


    <!-- Reservation Start -->
    <div class="container-xxl py-5 px-0 wow fadeInUp" data-wow-delay="0.1s">
        <div class="row g-0">
            <div id="success" class="testimonial-item bg-transparent border rounded p-4" style="display: none;">
                <div class="row g-3">
                    <div class="row align-items-center">
                        <p class="mx-auto" style=" font-weight: bolder;"  id="reservationComplete">
                            Sie haben Ihre Reservierung erfolgreich bearbeitet, checken Sie Ihr Email-Postfach!
                        </p>
                    </div>
                </div>
            </div>
            <div id="wait" class="testimonial-item bg-transparent border rounded p-4" >
                <div class="col-12">
                    <button id="loading" style="display: none;" class="btn btn-primary w-100 py-3" type="submit"  >Einen Moment</button>
                </div>
            </div>
            <div  id="editReservationBody"  class="p-5 wow fadeInUp" data-wow-delay="0.2s">
                <h5 class="section-title ff-secondary text-start text-primary fw-normal">Ihre Reservierung</h5>
                <h1 class="text-black-50 mb-4">Bearbeiten Sie hier ihre Reservierung</h1>
                <form>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="lastName">
                                <label for="name">Ihr Name</label>
                            </div>
                        </div>
                        <div hidden class="col-md-6">
                            <div class="form-floating">
                                <input type="password" class="form-control" id="uuid">
                                <label for="uuid">uuid</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="email" class="form-control" id="email">
                                <label for="email">Ihre E-Mail</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating date" id="date3" data-target-input="nearest">
                                <input type="datetime-local" class="form-control datetimepicker-input" id="reservationDate" placeholder="Date & Time" data-target="#date3" data-toggle="datetimepicker" />
                                <label for="datetime">Datum und Uhrzeit</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="numberOfKids" >
                                <label for="numberOfKids">Anzahl Kinder</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="numberOfPeople">
                                <label for="numberOfAdults">Anzahl Erwachsene</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="phoneNumber">
                                <label for="phoneNumber">Ihre Nummer</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-floating">
                                <textarea class="form-control" placeholder="Special Request" id="commentFromGuestUser" style="height: 100px"></textarea>
                                <label for="message">Special Request</label>
                            </div>
                        </div>
                        <div class="col-md">
                            <div class="form-floating">
                                <input type="checkbox" value="moin" id="birthday"> <span>Geburtstag</span>
                            </div>
                        </div>
                        <div class="col-md">
                            <div class="form-floating">
                                <input type="checkbox" value="moin" id="romanticDate"> <span>Romantisches Date</span>
                            </div>
                        </div>
                        <div class="col-md">
                            <div class="form-floating">
                                <input type="checkbox" value="moin" id="windowSeat"> <span>Fensterplatz</span>
                            </div>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-primary w-100 py-3" type="submit" onclick="editReservation()">Änderung bestätigen</button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>


    <!-- Reservation Start -->


    <!-- Footer Start -->
    <div id="impressum" class="container-fluid bg-dark text-light footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-4 col-md-6">
                    <h4 class="section-title ff-secondary text-start text-primary fw-normal mb-4">Impressum</h4>
                    <a class="btn btn-link" href="">Oishii Restaurant</a>
                    <a class="btn btn-link" href="">Wilhelmstraße 58a, 65183 Wiesbaden</a>
                    <a class="btn btn-link" href="">Gesetzlicher Vertreter: Jinguo Mu</a>
                    <a class="btn btn-link" href="">kontakt@oishii-wiesbaden.de</a>
                    <a class="btn btn-link" href="https://ec.europa.eu/consumers/odr" target="_blank">Plattform der EU-Kommission zur Online-Streitbeilegung</a>
                </div>
                <div class="col-lg-4 col-md-6">
                    <h4 class="section-title ff-secondary text-start text-primary fw-normal mb-4">Kontakt</h4>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>Wilhelmstraße 58a, 65183 Wiesbaden</p>
                    <a class="mb-2" href="tel:+4961123835808"><i class="fa fa-phone-alt me-3"></i>0611-23835808</a>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i>kontakt@oishii-wiesbaden.de</p>
                </div>
                <div id="newsletter" class="col-lg-4 col-md-6">
                    <h4 class="section-title ff-secondary text-start text-primary fw-normal mb-4">Newsletter</h4>
                    <p>Abonieren Sie unseren Newsletter und erhalten Sie kostenlose Gutscheine.</p>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <input id="newsletterInput"class="form-control border-primary w-100 py-3 ps-4 pe-5" type="text" placeholder="Ihre Email">
                        <button type="button"onclick="wantNewsletter()" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">Eintragen</button>
                    </div>
                </div>
                <div id="newsletterConfirmation" class="col-lg-4 col-md-6" style="display: none;">
                    <h4 class="section-title ff-secondary text-start text-primary fw-normal mb-4">Newsletter</h4>
                    <p>Vielen Dank, dass Sie unseren Newsletter abonniert haben. Wir freuen uns auf Sie!</p>

                </div>
            </div>
        </div>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">Oishii Wiesbaden</a>, All Right Reserved.

                        <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                        Template By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a><br><br>
                        Distributed By <a class="border-bottom" href="https://themewagon.com" target="_blank">ThemeWagon</a><br><br>
                        Adapted By <a class="border-bottom" href="https://gaikai.eu" target="_blank">Gaikai</a><br/>
                        <!--Photo by <a href="https://unsplash.com/s/photos/maki-sushi#:~:text=Photo%20by%20Cath%20Smith%20on%20Unsplash">Cath Smith</a> on <a href="https://unsplash.com/s/photos/maki-sushi#:~:text=Cath%20Smith%20on-,Unsplash">Unsplash</a>-->
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <div class="footer-menu">
                            <a href="">Home</a>
                            <a href="datenschutz.html">Datenschutz</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
</div>

<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="lib/wow/wow.min.js"></script>
<script src="lib/easing/easing.min.js"></script>
<script src="lib/waypoints/waypoints.min.js"></script>
<script src="lib/counterup/counterup.min.js"></script>
<script src="lib/owlcarousel/owl.carousel.min.js"></script>
<script src="lib/tempusdominus/js/moment.min.js"></script>
<script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
<script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

<!-- Template Javascript -->
<script src="js/main.js"></script>
<script>
     const BASE_URL =  "https://server.gaikai.xyz:8888/api/GuestUserService/noAuth";
     const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
     const email = urlParams.get('email');
    const uuid = urlParams.get('uuid');
    class EditReservation {
        constructor(uuid,email, lastName, phoneNumber, reservationDate, numberOfPeople, numberOfKids, commentFromGuestUser, birthday, romanticDate,windowSeat) {
           this.uuid=uuid
            this.reservationDate = reservationDate;
            this.numberOfPeople = numberOfPeople;
            this.numberOfKids = numberOfKids;
            this.commentFromGuestUser = commentFromGuestUser;
            this.phoneNumber = phoneNumber;
            this.email = email
            this.lastName = lastName;
            this.birthday = birthday;
            this.romanticDate = romanticDate;
            this.windowSeat = windowSeat;
        }
    }
    window.onload = function() {
         checkIfAuthorized();
  // var getInput = prompt("Hey type something here: ");
   

}
function checkIfAuthorized(){
    loading(true);
    //console.log("go!!!!!!!");
    var reservation="";
   

    let url = BASE_URL + "/api/ReservationService/noAuth/" +email+"/"+uuid;
            console.log(url);
            let xhr = new XMLHttpRequest();
            xhr.open("GET", url);
          
           xhr.setRequestHeader("Accept", "application/json");
           xhr.setRequestHeader("Content-Type", "application/json");
          xhr.setRequestHeader("Access-Control-Allow-Origin","*");
         

            xhr.onreadystatechange = function () {
              
                    console.log(xhr.responseText);
                    var reservation = JSON.parse(xhr.responseText);
                    localStorage.setItem("reservation",reservation)
                    console.log("Reservation*:")
                    console.log(reservation.email)
                    document.getElementById("reservationDate").value = reservation.reservationDate.split(".")[0];
                    console.log("value");
                    console.log(document.getElementById("reservationDate").value);
                    console.log("dto:");
                    console.log(reservation.reservationDate);
                    document.getElementById("uuid").value =reservation.uuid;
                    document.getElementById("email").value =reservation.email;
                    document.getElementById("lastName").value =reservation.lastName;
                    document.getElementById("phoneNumber").value =reservation.phoneNumber;
                    document.getElementById("numberOfKids").value =reservation.numberOfKids;
                    document.getElementById("numberOfPeople").value = reservation.numberOfPeople;
                    document.getElementById("commentFromGuestUser").value = reservation.commentFromGuestUser;
                    document.getElementById("birthday").checked = reservation.birthday;
                    document.getElementById("romanticDate").checked = reservation.romanticDate;
                    document.getElementById("windowSeat").checked = reservation.windowSeat;
                   
                    if (reservation.id != -1) {
                    //    loading(false);
                       // makeSuccessVisible()

                    }
                    

                
            };
            xhr.send();
            console.log(localStorage.getItem("reservation"));
            loading(false);
           
}

function editReservation(){
    loading(true);
            let url = BASE_URL + "/api/ReservationService/noAuth/edit"
            console.log(url);
            let xhr = new XMLHttpRequest();
            xhr.open("POST", url);
            xhr.setRequestHeader("Accept", "application/json");
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function () {
               
                    console.log(xhr.responseText);
                    var success = xhr.responseText;
                    
                    if (xhr.responseText=="true") {
                        loading(false);  
                        editingSuccessfull(true);
                    }else{
                        loading(false);
                        editingSuccessfull(false); 
                    }
                
            };


            let reservationDate = document.getElementById("reservationDate").value;
            let numberOfPeople = document.getElementById("numberOfPeople").value;
            let numberOfKids = document.getElementById("numberOfKids").value;
            let commentFromGuestUser = document.getElementById("commentFromGuestUser").value;
            let phoneNumber = document.getElementById("phoneNumber").value;
            let lastName = document.getElementById("lastName").value;
            let birthday = document.getElementById("birthday").checked;
            let romanticDate = document.getElementById("romanticDate").checked;
            let windowSeat = document.getElementById("windowSeat").checked;
            let email = document.getElementById("email").value;
            
            let reservation = new EditReservation(uuid, email, lastName, phoneNumber, reservationDate, numberOfPeople, numberOfKids,
                  commentFromGuestUser,birthday,romanticDate,windowSeat);
            let reservationJSON = JSON.stringify(reservation);
            console.log(reservationJSON);
            xhr.send(reservationJSON);
}
function loading(boolean){
        if(!boolean){
            document.getElementById("wait").style.display = 'none'
            document.getElementById("editReservationBody").style.display = 'block';
        }else{
            document.getElementById("wait").style.display = 'block'
            document.getElementById("editReservationBody").style.display = 'none';
        }

    }
function editingSuccessfull(boolean){
        if(boolean){
            document.getElementById("success").style.display = 'block'
            document.getElementById("editReservationBody").style.display = 'none';
        }else{
            document.getElementById("loading").style.display = 'none'
            document.getElementById("editReservationBody").style.display = 'block';
        } 

    }
</script>
</body>

</html>